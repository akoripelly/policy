<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author"
	content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
<meta name="generator" content="Jekyll v3.8.6">

<title>Form</title>
<link rel="stylesheet" href="css/bootstrap.css" />
<!-- <link rel="stylesheet" href="css/Datatable/dataTables.bootstrap4.min.css" />
<link rel="stylesheet" href="css/plugins/dataTables/datatables.min.css" /> -->
<!--<link rel="stylesheet" href=" https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">-->
<link rel="stylesheet" href="css/Datatable/buttons.bootstrap4.min.css" />

<link rel="stylesheet"
	href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet" />
<link href="css/plugins/dataTables/dataTables.responsive.css"
	rel="stylesheet" />
<link rel="stylesheet" href="css/custom.css" />
<style>
.pull-right {
	float: right;
}

.mt-30 {
	margin-top: 30px;
}
</style>
<script src="js/jquery-3.3.1.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="js/plugins/dataTables/datatables.min.js"></script>
<script src="js/plugins/dataTables/angular-datatables.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
</head>
<body class="bg-light" ng-app="app">
	<div class="container-fluid" ng-controller="ServeCtrl as business">
		<div class="text-center">
			<h3>MDM Serving By Snowflake</h3>
		</div>

		<div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-body">
						<form name="policyForm" ng-submit="business.send();">
							<div class="form-row">
								<div class="col-md-3 mb-3">
									<label for="policyid">Policy Id</label> <input type="text"
										ng-model="business.model.policyId" class="form-control"
										id="policyId" name="policyId" />

								</div>
								<div class="col-md-3 mb-3">
									<label for="processdate">Process Date</label> <input
										type="text" class="form-control datepicker" id="processDate"
										placeholder="mm/dd/yyyy" name="processDate"
										ng-model="business.model.processDate" />

								</div>
								<div class="col-md-3 mb-3">
									<label for="state">State</label> <select id="state"
										name="state" class="form-control"
										ng-model="business.model.state">
										<option selected>Choose...</option>
										<option value="il">IL</option>
										<option value="tx">TX</option>
										<option value="ca">CA</option>
									</select>
								</div>
								<div class="col-md-3 mb-3">
									<label for="lineofbusiness">Line of Business</label> <input
										type="text" class="form-control" id="lineofbusiness"
										name="lineOfBusiness" ng-model="business.model.lineOfBusiness" />
								</div>
							</div>
							<div class="form-row">
								<div class="col-md-3 mb-3">
									<label for="processcode">Status Code</label> <input type="text"
										class="form-control" id="statusCode" name="statusCode"
										ng-model="business.model.statusCode" />
								</div>
								<div class="col-md-3 mb-3">
									<label for="productcode">Company Product Code</label> <input
										type="text" class="form-control" id="productCode"
										name="productCode" ng-model="business.model.productCode" />

								</div>
								<div class="col-md-3 mb-3">
									<label for="effectivedate">Effective Date</label> <input
										type="text" class="form-control datepicker" id="effectiveDate"
										name="effectiveDate" ng-model="business.model.effectiveDate"
										placeholder="mm/dd/yyyy" />
								</div>

								<div class="col-md-3 mb-3">
									<label for="output">Output Type</label> <select id="outputType"
										name="outputType" ng-model="business.model.outputType"
										class="form-control">
										<option selected>Choose...</option>
										<option>Save CSV</option>
										<option>Save pdf</option>
									</select>
								</div>
							</div>
						</form>
						<div class="pull-right">
							<input class="btn btn-primary" type="submit" value="Submit" />
						</div>
					</div>
				</div>
			</div>
		</div>
		<br />
		<div class="row clearfix">
			<div class="col-md-12">
				<div class="card">
					<div class="card-body">
						<!-- Grid--->
						<table id="example" datatable="" dt-options="business.dtOptions"
							dt-columns="business.dtColumns" dt-instance="business.dtInstance"
							class="table table-striped table-hover hitTable clustertable datatable table mdmtable display nowrap"
							width="100%">


						</table>
					</div>
				</div>
			</div>
		</div>
	</div>


	<script src="js/plugins/dataTables/datatables.min.js"
		th:src="@{js/plugins/dataTables/datatables.min.js}"></script>

	<script src="js/plugins/dataTables/angular-datatables.js"
		th:src="@{js/plugins/dataTables/angular-datatables.js}"></script>
	<script
		src="js/plugins/dataTables/colreorder/angular-datatables.colreorder.js"
		th:src="@{js/plugins/dataTables/colreorder/angular-datatables.colreorder.js}"></script>
	<script
		src="js/plugins/dataTables/dataTables.responsive.min.js"
		th:src="@{js/plugins/dataTables/dataTables.responsive.min.js}"></script>
	<!-- <script src="js/Datatable/jquery.dataTables.min.js"></script>
		<script src="js/Datatable/dataTables.bootstrap4.min.js"></script>
		<script src="js/Datatable/dataTables.buttons.min.js"></script>
		<script src="js/Datatable/buttons.bootstrap4.min.js"></script>
		<script src="js/Datatable/jszip.min.js"></script>
		<script src="js/Datatable/vfs_fonts.js"></script>
		<script src="js/Datatable/buttons.html5.min.js"></script>
		<script src="js/Datatable/buttons.print.min.js"></script>
		<script src="js/Datatable/buttons.colVis.min.js"></script>
		<script>  
			$(document).ready(function() {
			    var table = $('#example').DataTable( {
					lengthChange: false,
					buttons: [ 'copy', 'excel', 'pdf', 'csv'],
					scrollY: '30vh',
					scrollX: true,
					paging:false
			    });
			    table.buttons().container().appendTo('#example_wrapper .col-md-6:eq(0)');
			});
		</script> -->
	<script>
		$(function() {
			$(".datepicker").datepicker();
		});

		$("#processDate").blur(function() {
			val = $(this).val();
			val1 = Date.parse(val);
			if (isNaN(val1) == true && val !== '') {
				$('#processDate').val('')
			}
		});
		$("#effectiveDate").blur(function() {
			val = $(this).val();
			val1 = Date.parse(val);
			if (isNaN(val1) == true && val !== '') {
				$('#effectiveDate').val('')
			}
		});
	</script>
	<script>
		var app = angular.module('app', [ 'datatables' ]);
		app.controller('ServeCtrl', ServeCtrl);
		function ServeCtrl($http, DTOptionsBuilder ,DTColumnBuilder) {
			var business = this;

			business.send = function() {
				console.log('Called');
				$http({
					method : 'POST',
					url : '/ServletDate',
					headers : {
						'Content-Type' : 'application/json'
					},
					data : business.model
				}).then(function success(response) {
					alert('Success');
				}, function error(response) {
					alert('Failed');
				});
			}

			business.loadResults = function() {
				$http({
					method : 'get',
					url : 'sample-data.csv',
					headers : {
						'Content-Type' : 'application/json'
					},
					data : business.model
				}).then(function success(response) {
					console.log(response)
					
				}, function error(response) {
					alert('Failed');
				});
			}
			
			business.loadResults();
			
			business.dtInstance = {};
			
			business.dtOptions = DTOptionsBuilder.fromSource('sample-data.csv').withDataProp(function(response) {
				var allTextLines = response.data.split(/\r\n|\n/);
		        business.headers = allTextLines[0].split(',');
		        var lines = [];
		        business.dtColumns = []
		        angular.forEach(business.headers,function(colName){
		        	var col = DTColumnBuilder.newColumn(null).withTitle(colName).notSortable()
		        	business.dtColumns.push(col);	
				});
		        for ( var i = 1; i < allTextLines.length; i++) {
		            // split content based on comma
		            var data = allTextLines[i].split(',');
		            if (data.length == headers.length) {
		                var tarr = [];
		                for ( var j = 0; j < headers.length; j++) {
		                    tarr.push(data[j]);
		                }
		                lines.push(tarr);
		            }
		        }
		        business.data = lines;
				return business.data;
			})
			.withDisplayLength(15)
		    .withOption("lengthMenu", [10, 15, 20, 25, 50, 100])	
			.withOption('responsive', true)
			.withOption('createdRow', createdRow)
			//.withOption('rowCallback', rowCallback);
			
			business.dtColumns = [DTColumnBuilder.newColumn("").withTitle("test").notSortable()];
			
			function createdRow(row, data, dataIndex) {
				// Recompiling so we can bind Angular directive to the DT
				$compile(angular.element(row).contents())($scope);
			}
			
		}
	</script>

</body>
</html>
