
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="">
<meta name="author"
	content="Mark Otto, Jacob Thornton, and Bootstrap contributors">


<meta name="generator" content="Jekyll v3.8.6">

<title>Form</title>

<link rel="stylesheet" href="css/bootstrap.css">
<link rel="stylesheet" href="css/Datatable/dataTables.bootstrap4.min.css">
<!--  <link rel="stylesheet" href=" https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css">-->
<link rel="stylesheet" href="css/Datatable/buttons.bootstrap4.min.css">
<link rel="stylesheet" href="css/custom.css">

<style>
.pull-right {
	float: right;
}

.mt-30 {
	margin-top: 30px;
}
</style>
</head>
<body class="bg-light" ng-app="app"
	ng-controller="ServeCtrl as business">
	<div class="container-fluid">
		<div class="text-center">

			<h3>MDM Serving By Snowflake</h3>

		</div>

		<div class="row">
			<div class="col-md-12">
				<div class="card">
					<div class="card-body">
						<form id="serveForm" name="serveForm">
							<div class="form-row">
								<div class="col-md-3 mb-3">
									<label for="policyid">Policy Id</label> <input type="text"
										class="form-control" id="policyId" name="policyId" />

								</div>
								<div class="col-md-3 mb-3">
									<label for="processdate">Process date</label> <input
										type="date" class="form-control" id="processdate" />

								</div>
								<div class="col-md-3 mb-3">
									<label for="state">State</label> <select id="state"
										class="form-control">
										<option selected>Choose...</option>
										<option>State</option>
									</select>
								</div>
								<div class="col-md-3 mb-3">
									<label for="lineofbusiness">Line of Business</label> <input
										type="text" class="form-control" id="lineofbusiness" />

								</div>
							</div>
							<div class="form-row">
								<div class="col-md-3 mb-3">
									<label for="processcode">Process code</label> <input
										type="text" class="form-control" id="processcode">

								</div>
								<div class="col-md-3 mb-3">
									<label for="productcode">Company Product Code</label> <input
										type="text" class="form-control" id="productcode" />

								</div>
								<div class="col-md-3 mb-3">
									<label for="effectivedate">Effective Date</label> <input
										type="date" class="form-control" id="effectivedate"
										placeholder="mm/dd/yyyy" />

								</div>

								<div class="col-md-3 mb-3">
									<label for="outputType">Output Type</label> <select id="outputType"
										class="form-control">
										<option selected>Choose...</option>
										<option>Json</option>
										<option>CSV</option>
									</select>
								</div>
							</div>

							<div class="collapse" id="collapseExample">
								<div class="card card-body">
									<div class="form-row">
										<label for="query">Query </label> <input type="text"
											class="form-control" id="query" placeholder="Query" />
									</div>
								</div>
							</div>
						</form>
						<div class="pull-right">
							<div>
								<span ng-show="business.showTimer" id="timer"><timer id="time" /></span>
								<button class="btn btn-primary" ng-click="business.serve();">Serve</button>
							</div>
						</div>
					</div>
				</div>

			</div>
		</div>

		<br />
		<div class="row clearfix" ng-show="business.showResults">
			<div class="col-md-12">
				<div class="card">
					<div class="card-body">
						<!-- Grid--->
						<h5 class="head-abs">MDM Search results</h5>

						<table id="example" class="table mdmtable display nowrap"
							style="width: 100%">
							<!-- <thead>
								<tr>
									<th ng-repeat="header in business.headers">{{header}}</th>
								</tr>
							</thead>
							<tbody>
								<tr ng-repeat="row in business.data">
									<td ng-repeat="val in row">{{val}}</td>
								</tr>
							</tbody>-->

						</table>

						<div class="modal fade" id="exampleModalScrollable" tabindex="-1"
							role="dialog" aria-labelledby="exampleModalScrollableTitle"
							aria-hidden="true">
							<div
								class="modal-dialog modal-dialog-scrollable modal-dialog-centered"
								role="document">
								<div class="modal-content">
									<div class="modal-header">
										<h5 class="modal-title" id="exampleModalScrollableTitle">Json
										</h5>
										<button type="button" class="close" data-dismiss="modal"
											aria-label="Close">
											<span aria-hidden="true">&times;</span>
										</button>
									</div>
									<div class="modal-body">
										<pre>
		<code>
      [
	{
		color: "red",
		value: "#f00"
	},
	{
		color: "green",
		value: "#0f0"
	},
	{
		color: "blue",
		value: "#00f"
	},
	{
		color: "cyan",
		value: "#0ff"
	},
	{
		color: "magenta",
		value: "#f0f"
	},
	{
		color: "yellow",
		value: "#ff0"
	},
	{
		color: "black",
		value: "#000"
	}
]
</code>
			
		  </pre>
									</div>
									<!-- <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>-->
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script src="js/jquery-3.3.1.js"></script>
	<script src="js/jquery.validate.min.js"></script>
	<script src="js/bootstrap.js"></script>
	<script src="js/Datatable/jquery.dataTables.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
	<script src="js/timer.js"></script>
	<!--  <script src="js/Datatable/dataTables.bootstrap4.min.js"></script>
	  <script src="js/Datatable/dataTables.buttons.min.js"></script>
	  <script src="js/Datatable/buttons.bootstrap4.min.js"></script>
	  <script src="js/Datatable/jszip.min.js"></script>
	  <script src="js/Datatable/vfs_fonts.js"></script>
	   <script src="js/Datatable/buttons.html5.min.js"></script>
	   <script src="js/Datatable/buttons.print.min.js"></script>
	   <script src="js/Datatable/buttons.colVis.min.js"></script>-->

	<script>
		var app = angular.module('app', ['timer']);
		app.controller('ServeCtrl', ServeCtrl);
		function ServeCtrl($scope, $http, $q, $timeout) {
			var business = this;
			
			function validateForm(form) {
		    	return form.validate({
		    		rules: {
		    			'policyId' : {required:true}
		    		},
					messages: {
						'policyId' : {required : 'Policy Id is required'}
					}
				});
			}
			business.serve = function() {
				business.showTimer = true;
				$scope.$broadcast('timer-start');
				//$('timer')[0].start();
				$timeout(function() {
					business.loadResults().then(function(data) {
						var headers = []
						
						angular.forEach(business.headers,function(name){
							var header={ title: name }
							headers.push(header);
						});
						$('#example').DataTable({
							scrollY : '30vh',
							scrollX : true,
							paging : false,
							columns: headers,
							data: data
						});
						
						business.showResults = true;
						$scope.$broadcast('timer-stop');
						/* var time = parseInt($('#timer').val());
						var timeString = (time / 1000.0).toString();
						var parts = timeString.split('.');
						$('#timer').val(parts[0] +':'+ parts[1]) */
						//$('timer')[0].stop();
					});	
				}, 5000);
			}
			business.loadResults = function() {
				var deferred = $q.defer();
				var res;
				$http({
					method : 'GET',
					url : 'sample-data.csv',					
				}).then(function success(response) {
					var allTextLines = response.data.split(/\r\n|\n/);
			        business.headers = allTextLines[0].split(',');
			        var lines = [];

			        for ( var i = 1; i < allTextLines.length; i++) {
			            // split content based on comma
			            var data = allTextLines[i].split(',');
			            if (data.length == business.headers.length) {
			                var tarr = [];
			                for ( var j = 0; j < business.headers.length; j++) {
			                    tarr.push(data[j]);
			                }
			                lines.push(tarr);
			            }
			        }
			        business.data = lines;
			        deferred.resolve(business.data);
			        
				}, function error(response) {
					deferred.resolve("error")
				});
				res = deferred.promise;
				return $q.when(res);
			}
		}
	</script>
</body>
</html>
